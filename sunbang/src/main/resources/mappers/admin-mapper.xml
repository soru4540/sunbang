<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminMapper">
	<resultMap id="resultReport" type="Report">
		<id property="report_no" column="report_no" />
		<result property="report_system" column="report_system" />
		<result property="category" column="category" />
		<result property="reported_board" column="reported_board" />
		<result property="contents_no" column="contents_no" />
		<result property="contents" column="contents" />
		<result property="report_date" column="report_date" />
		<result property="handle_date" column="handle_date" />
		<result property="report_status" column="report_status" />
		<result property="user_no" column="user_no" />
	</resultMap>

	<resultMap id="resultGuide" type="Guide">
		<id property="guide_no" column="guide_no" />
		<result property="guide_system" column="guide_system" />
		<result property="category" column="category" />
		<result property="title" column="title" />
		<result property="thumbnail" column="thumbnail" />
		<result property="contents" column="contents" />
		<result property="guide_status" column="guide_status" />
	</resultMap>

	<resultMap type="PremiumFull" id="resultPremiumFull">
		<id property="charge_no" column="charge_no" />
		<result property="charge_date" column="charge_date" />
		<result property="expiration_date" column="expiration_date" />
		<result property="charged_payment" column="charged_payment" />
		<result property="charged_status" column="charged_status" />
		<result property="refund_date" column="refund_date" />
		<result property="user_no" column="user_no" />
		<result property="user_type" column="user_type" />
		<result property="user_profile" column="user_profile" />
		<result property="user_id" column="user_id" />
		<result property="nickname" column="nickname" />
		<result property="user_name" column="user_name" />		
		<result property="email" column="email" />
		<result property="phone" column="phone" />
		<result property="password" column="password" />
		<result property="join_date" column="join_date" />
		<result property="update_date" column="update_date" />
		<result property="user_status" column="user_status" />
		<result property="reason_leave" column="reason_leave" />
		<result property="login_num" column="login_num" />
		<result property="business_user_no" column="business_user_no" />
		<result property="office_name" column="office_name" />
		<result property="office_regist_no" column="office_regist_no" />
		<result property="business_license_no" column="business_license_no" />
		<result property="office_address" column="office_address" />
		<result property="office_phone" column="office_phone" />
		<result property="status_agreement" column="status_agreement" />
		<result property="premium_status" column="premium_status" />

	</resultMap>

	<select id="selectUnHandledList" parameterType="Report"
		resultMap="resultReport">
		select * from tb_report where report_status = 0
	</select>

	<select id="selectGuideAllList" parameterType="String"
		resultMap="resultGuide">
		select * from tb_guide
		where guide_system = #{guide_system}
		and guide_status = 1
	</select>

	<select id="selectGuideList" parameterType="String"
		resultMap="resultGuide">
		select * from tb_guide
		where category = #{category} and
		guide_status = 1
	</select>

	<select id="selectGuideDetail" parameterType="int"
		resultMap="resultGuide">
		select * from tb_guide
		where guide_no = #{guide_no}
	</select>

	<insert id="guideInsert" parameterType="Guide"
		useGeneratedKeys="true">
		insert into tb_guide
		values (guide_seq.nextval,
		#{guide_system}, #{category}, #{title},
		#{thumbnail}, #{contents},
		default)
	</insert>

	<update id="deleteGuide" parameterType="int">
		update tb_guide
		set
		guide_status = 0 where guide_no = #{guide_no}
	</update>

	<select id="selectPremiumList" parameterType="PremiumFull"
		resultMap="resultPremiumFull">
		<![CDATA[
		select * from (select rownum rnum, charge_no, charge_date, expiration_date, charged_payment, charged_status, refund_date, 
			business_user_no, office_name, office_regist_no,business_license_no,office_address,office_phone,status_agreement,premium_status,user_no,user_type,user_profile,user_id,nickname,user_name,email,phone,PASSWORD,join_date,update_date,user_status,reason_leave,login_num  
        from (select p.charge_no, p.charge_date, p.expiration_date, p.charged_payment, p.charged_status, p.refund_date, p.business_user_no, b.office_name, b.office_regist_no, b.business_license_no, b.office_address, b.office_phone, b.status_agreement, b.premium_status, u.user_no, u.user_type, u.user_profile, u.user_id,  u.nickname, u.user_name, u.email, u.phone, u.password, u.join_date, u.update_date, u.user_status, u.reason_leave, u.login_num 
			from tb_premium p inner join tb_business b on p.business_user_no = b.business_user_no inner join tb_user u on b.user_no = u.user_no order by charge_no desc)) 
		where rnum >= #{offset} and rnum <= #{limit}
         ]]>
	</select>

	<select id="selectListCount" resultType="_int">
		select count(*) from tb_premium
	</select>
	
	<select id="selectBusinessDetail" parameterType="_int" resultMap="resultPremiumFull">
		select p.charge_no, p.charge_date, p.expiration_date, p.charged_payment, p.charged_status, p.refund_date, p.business_user_no, b.office_name, b.office_regist_no, b.business_license_no, b.office_address, b.office_phone, b.status_agreement, b.premium_status, u.user_no, u.user_type, u.user_profile, u.user_id,  u.nickname, u.user_name, u.email, u.phone, u.password, u.join_date, u.update_date, u.user_status, u.reason_leave, u.login_num 
		from tb_premium p inner join tb_business b on p.business_user_no = b.business_user_no inner join tb_user u on b.user_no = u.user_no 
		where p.business_user_no = #{business_user_no}
	</select>
	
</mapper>